(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{1981:(e,t,s)=>{Promise.resolve().then(s.bind(s,4285))},4285:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>eA});var a=s(7437),r=s(2265),n=s(3191),l=s(932),i=s(5524),o=s(7589),d=s(3274),c=s(7592),u=s(4839),m=s(6164);function p(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,m.m6)((0,u.W)(t))}function h(e){if(!e)return"";try{if(e.startsWith('"')&&e.endsWith('"')||e.includes("\\n"))try{return JSON.parse('"'.concat(e.replace(/^"|"$/g,""),'"'))}catch(e){}return e.replace(/\\n/g,"\n").replace(/\\"/g,'"').replace(/\\'/g,"'").replace(/\\\\/g,"\\").replace(/\\t/g,"	").trim()}catch(t){return console.error("Error unescaping string:",t),e}}let f=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:p("rounded-lg border bg-card text-card-foreground shadow-sm",s),...r})});f.displayName="Card",r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:p("flex flex-col space-y-1.5 p-6",s),...r})}).displayName="CardHeader",r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("h3",{ref:t,className:p("text-2xl font-semibold leading-none tracking-tight",s),...r})}).displayName="CardTitle",r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("p",{ref:t,className:p("text-sm text-muted-foreground",s),...r})}).displayName="CardDescription",r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:p("p-6 pt-0",s),...r})}).displayName="CardContent",r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:p("flex items-center p-6 pt-0",s),...r})}).displayName="CardFooter";var g=s(1538),x=s(2218);let b=(0,x.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),j=r.forwardRef((e,t)=>{let{className:s,variant:r,size:n,asChild:l=!1,...i}=e,o=l?g.g7:"button";return(0,a.jsx)(o,{className:p(b({variant:r,size:n,className:s})),ref:t,...i})});j.displayName="Button";let N=r.forwardRef((e,t)=>{let{className:s,type:r,...n}=e;return(0,a.jsx)("input",{type:r,className:p("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:t,...n})});N.displayName="Input";let y=0,v=new Map,w=e=>{if(v.has(e))return;let t=setTimeout(()=>{v.delete(e),O({type:"REMOVE_TOAST",toastId:e})},1e6);v.set(e,t)},C=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:s}=t;return s?w(s):e.toasts.forEach(e=>{w(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===s||void 0===s?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},k=[],S={toasts:[]};function O(e){S=C(S,e),k.forEach(e=>{e(S)})}function E(e){let{...t}=e,s=(y=(y+1)%Number.MAX_VALUE).toString(),a=()=>O({type:"DISMISS_TOAST",toastId:s});return O({type:"ADD_TOAST",toast:{...t,id:s,open:!0,onOpenChange:e=>{e||a()}}}),{id:s,dismiss:a,update:e=>O({type:"UPDATE_TOAST",toast:{...e,id:s}})}}function R(){let[e,t]=r.useState(S);return r.useEffect(()=>(k.push(t),()=>{let e=k.indexOf(t);e>-1&&k.splice(e,1)}),[e]),{...e,toast:E,dismiss:e=>O({type:"DISMISS_TOAST",toastId:e})}}var _=s(430),F=s(2421),I=s(4392),A=s(2468);let D=_.fC;_.ZA;let T=_.B4,z=r.forwardRef((e,t)=>{let{className:s,children:r,...n}=e;return(0,a.jsxs)(_.xz,{ref:t,className:p("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...n,children:[r,(0,a.jsx)(_.JO,{asChild:!0,children:(0,a.jsx)(F.Z,{className:"h-4 w-4 opacity-50"})})]})});z.displayName=_.xz.displayName;let M=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(_.u_,{ref:t,className:p("flex cursor-default items-center justify-center py-1",s),...r,children:(0,a.jsx)(I.Z,{className:"h-4 w-4"})})});M.displayName=_.u_.displayName;let L=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(_.$G,{ref:t,className:p("flex cursor-default items-center justify-center py-1",s),...r,children:(0,a.jsx)(F.Z,{className:"h-4 w-4"})})});L.displayName=_.$G.displayName;let Z=r.forwardRef((e,t)=>{let{className:s,children:r,position:n="popper",...l}=e;return(0,a.jsx)(_.h_,{children:(0,a.jsxs)(_.VY,{ref:t,className:p("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===n&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:n,...l,children:[(0,a.jsx)(M,{}),(0,a.jsx)(_.l_,{className:p("p-1","popper"===n&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r}),(0,a.jsx)(L,{})]})})});Z.displayName=_.VY.displayName,r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(_.__,{ref:t,className:p("py-1.5 pl-8 pr-2 text-sm font-semibold",s),...r})}).displayName=_.__.displayName;let P=r.forwardRef((e,t)=>{let{className:s,children:r,...n}=e;return(0,a.jsxs)(_.ck,{ref:t,className:p("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...n,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(_.wU,{children:(0,a.jsx)(A.Z,{className:"h-4 w-4"})})}),(0,a.jsx)(_.eT,{children:r})]})});P.displayName=_.ck.displayName,r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(_.Z0,{ref:t,className:p("-mx-1 my-1 h-px bg-muted",s),...r})}).displayName=_.Z0.displayName;let q=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("textarea",{className:p("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:t,...r})});q.displayName="Textarea";var V=s(8364);let B=(0,x.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),J=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(V.f,{ref:t,className:p(B(),s),...r})});J.displayName=V.f.displayName;var U=s(9590),Y=s(7746),G=s(5733),H=s(6884);function Q(e){let{label:t,value:s,originalValue:n,onChange:l,onReset:i,hasChanged:o}=e,[d,c]=(0,r.useState)(""),[u,m]=(0,r.useState)(!1),{toast:g}=R();(0,r.useEffect)(()=>{let e=h(s);e!==d&&c(e)},[s]);let x=e=>{c(e),l(function(e){if(!e)return"";try{return JSON.stringify(e).slice(1,-1)}catch(t){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/'/g,"\\'").replace(/\n/g,"\\n").replace(/\t/g,"\\t").trim()}}(e))},b=async()=>{try{await navigator.clipboard.writeText(u?s:d),g({description:"Copied to clipboard",duration:1e3})}catch(e){console.error("Failed to copy text:",e),g({variant:"destructive",description:"Failed to copy text"})}};return(0,a.jsx)(f,{className:p("overflow-hidden bg-gradient-to-br from-card to-muted/50 border-border/50 shadow-sm",s!==n&&"border-l-4 border-l-orange-500 dark:border-l-orange-600"),children:(0,a.jsxs)("div",{className:"p-4 space-y-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(J,{htmlFor:t,className:"text-lg font-semibold text-foreground",children:t.replace(/_/g," ")}),s!==n&&(0,a.jsx)("span",{className:"text-xs px-2 py-1 rounded-full bg-orange-100 dark:bg-orange-900/50 text-orange-700 dark:text-orange-300",children:"Modified"})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[s!==n&&(0,a.jsx)(j,{variant:"ghost",size:"sm",onClick:()=>{i&&(c(h(n)),i(),g({description:"Reset to original value",duration:1e3}))},className:"hover:bg-muted text-muted-foreground hover:text-foreground",title:"Reset to original",children:(0,a.jsx)(U.Z,{className:"h-4 w-4"})}),(0,a.jsxs)(j,{variant:"ghost",size:"sm",onClick:()=>m(!u),className:"hover:bg-muted text-muted-foreground hover:text-foreground",children:[u?(0,a.jsx)(Y.Z,{className:"h-4 w-4"}):(0,a.jsx)(G.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"ml-2",children:u?"Edit":"Preview"})]}),(0,a.jsx)(j,{variant:"ghost",size:"sm",onClick:b,className:"hover:bg-muted text-muted-foreground hover:text-foreground",children:(0,a.jsx)(H.Z,{className:"h-4 w-4"})})]})]}),(0,a.jsx)("div",{className:"relative rounded-lg overflow-hidden border border-border bg-card",children:(0,a.jsx)(q,{id:t,value:u?s:d,onChange:e=>x(e.target.value),disabled:u,className:p("min-h-[200px] p-4 font-mono text-sm leading-relaxed",u?"bg-muted/50 cursor-not-allowed":"bg-card focus:bg-muted/30","whitespace-pre-wrap border-0 resize-y","text-foreground placeholder-muted-foreground","focus:ring-1 focus:ring-border","transition-colors duration-200"),spellCheck:!1,placeholder:"Enter your prompt here..."})})]})})}let X={"Optin No Book":["Onb_Identity","Onb_Task","Onb_Steps","ONB_Response_Guildelines","ONB_Style","ONB_Specifics","Onb_Notes","Onb_Example"],"Database Reactivation":["Dbr_Identity","Dbr_Task","DBR_Steps","DBR_Notes","DBR_Example"],Appointments:["Appointments_Identity","Confirmation_Task","Confirmation_Steps","Appointments Example","Appointments_Notes","Reminders_Task","Reminders 1 Steps","Reminders 2 Steps"],"No Show":["No Show Identity","No Show Task","No Show Steps"],Inbound:["Inbound Identity","Inbound Task","Inbound Steps","Inbound Response Guidlines","Inbound Specifics","Inbound Notes","Inbound Examples"],"Call Later":["Call Later Task","Call Later Steps","Call Later DBR Steps","Call Later Examples"],"After Hours":["Afterhours Inbound Steps","Afterhours Inbound Response Guidlines","Afterhours Inbound Notes","Afterhours Inbound Examples"]},$={"Optin No Book":"Prompts for handling leads who opted in but haven't booked","Database Reactivation":"Prompts for reactivating leads from the database",Appointments:"Prompts for handling appointment-related interactions","No Show":"Prompts for following up with no-show clients",Inbound:"Prompts for handling inbound inquiries","Call Later":"Prompts for scheduling follow-up calls","After Hours":"Prompts for after-hours responses",Other:"Additional prompt configurations"};function W(e){let{data:t,originalData:s,onUpdate:n,onReset:l,modifiedFields:i}=e,[o,d]=(0,r.useState)("Optin No Book");if(!t||!s)return null;let c=Object.keys(t),u=new Set(Object.values(X).flat()),m=c.filter(e=>!u.has(e)&&"Niche Name"!==e),p={...X,Other:m},h=Object.entries(p).filter(e=>{let[t,s]=e;return s.length>0&&s.some(e=>c.includes(e))}).map(e=>{let[t]=e;return t});(0,r.useEffect)(()=>{!h.includes(o)&&h.length>0&&d(h[0])},[h,o]);let f=(0,r.useMemo)(()=>{let e={};return i.forEach(t=>{Object.entries(X).forEach(s=>{let[a,r]=s;r.includes(t)&&(e[a]=(e[a]||0)+1)}),Object.values(X).flat().includes(t)||(e.Other=(e.Other||0)+1)}),e},[i]),g=(0,r.useMemo)(()=>Object.values(f).reduce((e,t)=>e+t,0),[f]);return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center bg-gradient-to-r from-background to-muted p-4 rounded-lg border border-border/50 shadow-sm",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-xl font-semibold text-foreground",children:"Prompt Editor"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:$[o]})]}),g>0&&(0,a.jsxs)("span",{className:"text-sm px-2 py-1 rounded-full bg-orange-100 dark:bg-orange-900/50 text-orange-700 dark:text-orange-300",children:[g," modified field",1===g?"":"s"]})]}),(0,a.jsxs)(D,{value:o,onValueChange:e=>d(e),children:[(0,a.jsx)(z,{className:"w-[200px] bg-card border-border text-foreground",children:(0,a.jsx)(T,{placeholder:"Select group"})}),(0,a.jsx)(Z,{className:"bg-card border-border",children:h.map(e=>(0,a.jsxs)(P,{value:e,className:"text-foreground hover:bg-muted focus:bg-muted flex justify-between items-center",children:[(0,a.jsx)("span",{children:e}),f[e]>0&&(0,a.jsx)("span",{className:"ml-2 text-xs px-2 py-0.5 rounded-full bg-orange-100 dark:bg-orange-900/50 text-orange-700 dark:text-orange-300",children:f[e]})]},e))})]})]}),(0,a.jsx)("div",{className:"grid gap-6",children:p[o].filter(e=>c.includes(e)).map(e=>(0,a.jsx)(Q,{label:e,value:t[e]||"",originalValue:s[e]||"",onChange:t=>n(e,t),onReset:()=>null==l?void 0:l(e),hasChanged:i.has(e)},e))})]})}var K=s(4593);let ee="https://ysywtbtwtqaejftbjpet.supabase.co",et="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlzeXd0YnR3dHFhZWpmdGJqcGV0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MjczNjIxMzksImV4cCI6MjA0MjkzODEzOX0.MYcA9H3ujDStmmQF4UWYQYE9_eGLiL1glBYMuoStA18",es=(0,K.eI)(ee,et,{auth:{persistSession:!1},global:{headers:{apikey:et,Authorization:"Bearer ".concat(et)}}});async function ea(){console.log("Starting fetchNiches request...");try{var e;console.log("Making first test query...");let{data:t,error:s}=await es.from("agents_prompts").select("*").limit(1);console.log("All data test:",t),s&&console.error("Error in all data query:",s),console.log("Making niche name query...");let{data:a,error:r}=await es.from("agents_prompts").select('"Niche Name"');if(r)throw console.error("Error in niche query:",r),r;console.log("Raw data from Supabase:",a),a&&a.length>0&&(console.log("First row structure:",Object.keys(a[0])),console.log("First row values:",Object.values(a[0])));let n=null!==(e=null==a?void 0:a.map(e=>(console.log("Processing row:",e),e["Niche Name"])))&&void 0!==e?e:[];return console.log("Final processed niches:",n),n}catch(e){throw console.error("Error in fetchNiches:",e),e}}async function er(e){console.log("Fetching prompts for niche:",e);try{let{data:t,error:s}=await es.from("agents_prompts").select("*").eq("Niche Name",e).single();if(console.log("Niche prompts response:",{data:t,error:s}),s)throw console.error("Error fetching niche prompts:",s),s;return t}catch(e){throw console.error("Error in fetchNichePrompts:",e),e}}async function en(e,t){console.log("Updating prompts for niche:",e),console.log("Updates:",t);try{let{error:s}=await es.from("agents_prompts").update(t).eq("Niche Name",e);if(s)throw console.error("Error updating niche prompts:",s),s;return!0}catch(e){throw console.error("Error in updateNichePrompts:",e),e}}async function el(){console.log("Testing connection to:",ee);try{let{data:e,error:t}=await es.from("agents_prompts").select("*",{count:"exact",head:!0});if(console.log("Test connection response:",{data:e,error:t}),t)return console.error("Connection test error:",t),!1;return!0}catch(e){return console.error("Connection test failed:",e),!1}}var ei=s(3304),eo=s(4697);let ed=ei.fC,ec=ei.xz,eu=ei.h_;ei.x8;let em=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(ei.aV,{ref:t,className:p("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...r})});em.displayName=ei.aV.displayName;let ep=r.forwardRef((e,t)=>{let{className:s,children:r,...n}=e;return(0,a.jsxs)(eu,{children:[(0,a.jsx)(em,{}),(0,a.jsxs)(ei.VY,{ref:t,className:p("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...n,children:[r,(0,a.jsxs)(ei.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,a.jsx)(eo.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});ep.displayName=ei.VY.displayName;let eh=e=>{let{className:t,...s}=e;return(0,a.jsx)("div",{className:p("flex flex-col space-y-1.5 text-center sm:text-left",t),...s})};eh.displayName="DialogHeader";let ef=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(ei.Dx,{ref:t,className:p("text-lg font-semibold leading-none tracking-tight",s),...r})});ef.displayName=ei.Dx.displayName,r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(ei.dk,{ref:t,className:p("text-sm text-muted-foreground",s),...r})}).displayName=ei.dk.displayName;var eg=s(23);let ex=r.forwardRef((e,t)=>{let{className:s,children:r,...n}=e;return(0,a.jsxs)(eg.fC,{ref:t,className:p("relative overflow-hidden",s),...n,children:[(0,a.jsx)(eg.l_,{className:"h-full w-full rounded-[inherit]",children:r}),(0,a.jsx)(eb,{}),(0,a.jsx)(eg.Ns,{})]})});ex.displayName=eg.fC.displayName;let eb=r.forwardRef((e,t)=>{let{className:s,orientation:r="vertical",...n}=e;return(0,a.jsx)(eg.gb,{ref:t,orientation:r,className:p("flex touch-none select-none transition-colors","vertical"===r&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===r&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",s),...n,children:(0,a.jsx)(eg.q4,{className:"relative flex-1 rounded-full bg-border"})})});eb.displayName=eg.gb.displayName;var ej=s(4817);function eN(e){let{niches:t,onNicheSelect:s,isLoading:n,onOpen:l}=e,[i,o]=(0,r.useState)(!1),[d,u]=(0,r.useState)(""),[m,p]=(0,r.useState)([]);(0,r.useEffect)(()=>{i&&l()},[i,l]),(0,r.useEffect)(()=>{if(!d.trim()){p([]);return}let e=[],s=d.toLowerCase();Object.entries(t).forEach(t=>{let[a,r]=t,n=[];Object.entries(r).forEach(e=>{let[t,a]=e;if("string"==typeof a&&a.toLowerCase().includes(s)){let e=a.toLowerCase().indexOf(s),r=Math.max(0,e-40),l=Math.min(a.length,e+s.length+40),i=a.slice(r,l);r>0&&(i="..."+i),l<a.length&&(i+="..."),n.push({field:t,preview:i})}}),n.length>0&&e.push({nicheName:a,matches:n})}),p(e)},[d,t]);let h=e=>{s(e),o(!1)};return(0,a.jsxs)(ed,{open:i,onOpenChange:o,children:[(0,a.jsx)(ec,{asChild:!0,children:(0,a.jsxs)(j,{variant:"outline",className:"w-full",disabled:n,children:[(0,a.jsx)(ej.Z,{className:"h-4 w-4 mr-2"}),n?"Loading niches...":"Search prompts..."]})}),(0,a.jsxs)(ep,{className:"max-w-2xl h-[80vh]",children:[(0,a.jsx)(eh,{children:(0,a.jsx)(ef,{children:"Search Prompts"})}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(N,{placeholder:"Search prompt content...",value:d,onChange:e=>u(e.target.value),className:"w-full",autoFocus:!0}),(0,a.jsx)(ex,{className:"h-[calc(80vh-120px)]",children:(0,a.jsxs)("div",{className:"space-y-4",children:[m.map(e=>{let{nicheName:t,matches:s}=e;return(0,a.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,a.jsxs)(j,{variant:"ghost",className:"w-full justify-start text-lg font-semibold mb-2",onClick:()=>h(t),children:[(0,a.jsx)(c.Z,{className:"h-4 w-4 mr-2"}),t]}),(0,a.jsx)("div",{className:"space-y-2 pl-6",children:s.map((e,t)=>{let{field:s,preview:r}=e;return(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsxs)("span",{className:"font-medium text-stone-600",children:[s,":"]}),(0,a.jsx)("p",{className:"mt-1 text-stone-800 bg-stone-50 p-2 rounded",children:r})]},t)})})]},t)}),d&&0===m.length&&(0,a.jsx)("div",{className:"text-center text-stone-500 py-8",children:"No results found"})]})})]})]})]})}var ey=s(9324);let ev=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(ey.fC,{ref:t,className:p("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s),...r,children:(0,a.jsx)(ey.z$,{className:p("flex items-center justify-center text-current"),children:(0,a.jsx)(A.Z,{className:"h-4 w-4"})})})});ev.displayName=ey.fC.displayName;var ew=s(645);let eC=[{name:"Double Quotes in Expressions",find:'(?<=\\{\\{[^}]*)"(?=[^}]*\\}\\})',replace:"'",isRegex:!0}];function ek(e){let{niches:t,onReplace:s,isLoading:n,onOpen:l}=e,[i,o]=(0,r.useState)(!1),[d,c]=(0,r.useState)(""),[u,m]=(0,r.useState)(""),[p,h]=(0,r.useState)(!1),[f,g]=(0,r.useState)(new Set),[x,b]=(0,r.useState)(!0),[y,v]=(0,r.useState)([]),{toast:w}=R();(0,r.useEffect)(()=>{i&&l()},[i,l]),(0,r.useEffect)(()=>{if(!d){v([]);return}try{let e=d;p&&(e=new RegExp(d,x?"g":"gi"));let s=[];f.forEach(a=>{let r=t[a];if(!r)return;let n=[];Object.entries(r).forEach(t=>{let[s,a]=t;if("string"==typeof a){let t=0,r=[];if(p&&e instanceof RegExp){let s=a.match(e);if(t=(null==s?void 0:s.length)||0,s){let t;for(;null!==(t=e.exec(a));)r.push(t.index);e.lastIndex=0}}else if(!p){let e=x?d:d.toLowerCase(),s=x?a:a.toLowerCase(),n=0;for(;-1!==(n=s.indexOf(e,n));)r.push(n),n+=e.length,t++}if(t>0){let e=r[0],l=Math.max(0,e-20),i=Math.min(a.length,e+d.length+20),o=a.slice(l,i);l>0&&(o="..."+o),i<a.length&&(o+="..."),n.push({field:s,content:o,count:t})}}}),n.length>0&&s.push({nicheName:a,matches:n})}),v(s)}catch(e){v([])}},[d,t,f,x,p]);let C=e=>{c(e.find),m(e.replace),h(e.isRegex)};return(0,a.jsxs)(ed,{open:i,onOpenChange:o,children:[(0,a.jsx)(ec,{asChild:!0,children:(0,a.jsxs)(j,{variant:"outline",children:[(0,a.jsx)(ew.Z,{className:"h-4 w-4 mr-2"}),"Find & Replace"]})}),(0,a.jsxs)(ep,{className:"sm:max-w-[600px]",children:[(0,a.jsx)(eh,{children:(0,a.jsx)(ef,{children:"Find and Replace"})}),(0,a.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,a.jsx)("div",{className:"grid gap-2",children:eC.map(e=>(0,a.jsx)(j,{variant:"outline",onClick:()=>C(e),className:"justify-start font-mono text-sm",children:e.name},e.name))}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(ev,{id:"regex-mode",checked:p,onCheckedChange:e=>h(e)}),(0,a.jsx)(J,{htmlFor:"regex-mode",children:"Use regular expressions"})]}),(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(J,{htmlFor:"find",children:"Find"}),(0,a.jsx)(N,{id:"find",value:d,onChange:e=>c(e.target.value),placeholder:p?"Regular expression...":"Text to find...",className:"font-mono"})]}),(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(J,{htmlFor:"replace",children:"Replace with"}),(0,a.jsx)(N,{id:"replace",value:u,onChange:e=>m(e.target.value),placeholder:"Replacement pattern...",className:"font-mono"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(ev,{id:"case-sensitive",checked:x,onCheckedChange:e=>b(e)}),(0,a.jsx)(J,{htmlFor:"case-sensitive",children:"Case sensitive"})]}),(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(J,{children:"Select Niches"}),(0,a.jsx)(ex,{className:"h-[200px] border rounded-md p-2",children:(0,a.jsx)("div",{className:"grid gap-2",children:Object.keys(t).map(e=>(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(ev,{id:e,checked:f.has(e),onCheckedChange:t=>{let s=new Set(f);t?s.add(e):s.delete(e),g(s)}}),(0,a.jsx)(J,{htmlFor:e,children:e})]},e))})})]}),y.length>0&&(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsxs)(J,{children:["Matches Found (",y.reduce((e,t)=>{let{matches:s}=t;return e+s.reduce((e,t)=>{let{count:s}=t;return e+s},0)},0),")"]}),(0,a.jsx)(ex,{className:"h-[200px] border rounded-md p-2",children:(0,a.jsx)("div",{className:"grid gap-4",children:y.map(e=>{let{nicheName:t,matches:s}=e;return(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h4",{className:"font-medium",children:t}),(0,a.jsx)("div",{className:"pl-4 space-y-2",children:s.map((e,t)=>{let{field:s,content:r,count:n}=e;return(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsxs)("div",{className:"font-medium text-muted-foreground",children:[s," (",n," matches)"]}),(0,a.jsx)("code",{className:"block mt-1 p-2 rounded bg-muted text-xs whitespace-pre-wrap",children:r})]},"".concat(s,"-").concat(t))})})]},t)})})})]})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,a.jsx)(j,{variant:"outline",onClick:()=>o(!1),children:"Cancel"}),(0,a.jsx)(j,{onClick:()=>{if(d&&u)try{let e={},a=0;f.forEach(s=>{let r=t[s];if(!r)return;let n={...r},l=!1;Object.entries(r).forEach(e=>{let[t,s]=e;if("string"==typeof s){let e;let r=0;if(p){let t=new RegExp(d,x?"g":"gi"),a=s.match(t);r=(null==a?void 0:a.length)||0,e=s.replace(t,u)}else{let t=x?d:d.toLowerCase(),a=x?s:s.toLowerCase(),n=0;for(r=0;-1!==a.indexOf(t,n);)r++,n=a.indexOf(t,n)+t.length;if(x)e=s.split(d).join(u);else{let t=RegExp(d.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi");e=s.replace(t,u)}}e!==s&&(n[t]=e,l=!0,a+=r)}}),l&&(e[s]=n)}),Object.keys(e).length>0?(s(e),w({description:"Made ".concat(a," replacements across ").concat(Object.keys(e).length," niches")}),o(!1)):w({description:"No matches found to replace",variant:"destructive"})}catch(e){w({description:p?"Invalid regular expression":"An error occurred during replacement",variant:"destructive"})}},disabled:!d||!u||0===f.size,children:"Replace All"})]})]})]})}var eS=s(8296),eO=s(2699),eE=s(9512);function eR(){let{theme:e,setTheme:t}=(0,eE.F)();return(0,a.jsxs)(j,{variant:"ghost",size:"icon",onClick:()=>t("light"===e?"dark":"light"),className:"transition-colors duration-200",children:[(0,a.jsx)(eS.Z,{className:"h-5 w-5 rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0"}),(0,a.jsx)(eO.Z,{className:"absolute h-5 w-5 rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100"}),(0,a.jsx)("span",{className:"sr-only",children:"Toggle theme"})]})}var e_=s(903),eF=s(9291);let eI=(0,e_.U)()((0,eF.tJ)((e,t)=>({pendingChanges:{},originalData:{},dirtyFields:{},updatePrompt:(s,a,r)=>{let n=t(),l=n.originalData[s];if(!l)return;let i={...n.pendingChanges[s]||{...l},[a]:r},o=r!==l[a],d=new Set(n.dirtyFields[s]||[]);o?d.add(a):d.delete(a),e(e=>({pendingChanges:{...e.pendingChanges,[s]:i},dirtyFields:{...e.dirtyFields,[s]:Array.from(d)}}))},setPendingChanges:(s,a)=>{let r=t().originalData[s]||{},n=Object.keys(a).filter(e=>a[e]!==r[e]);e(e=>({pendingChanges:{...e.pendingChanges,[s]:a},dirtyFields:{...e.dirtyFields,[s]:n}}))},setOriginalData:(t,s)=>e(e=>({originalData:{...e.originalData,[t]:s}})),resetField:(s,a)=>{var r;let n=t(),l=n.originalData[s];if(!l)return;let i={...n.pendingChanges[s]||{...l}};i[a]=l[a];let o=(null===(r=n.dirtyFields[s])||void 0===r?void 0:r.filter(e=>e!==a))||[];e(e=>({pendingChanges:{...e.pendingChanges,[s]:i},dirtyFields:{...e.dirtyFields,[s]:o}}))},clearChanges:t=>{t?e(e=>{let{[t]:s,...a}=e.pendingChanges,{[t]:r,...n}=e.dirtyFields;return{pendingChanges:a,dirtyFields:n}}):e({pendingChanges:{},dirtyFields:{}})},batchUpdate:t=>e(e=>{let s={...e.pendingChanges},a={...e.dirtyFields};return Object.entries(t).forEach(t=>{let[r,n]=t,l=e.originalData[r]||{},i=Object.keys(n).filter(e=>n[e]!==l[e]);s[r]={...s[r]||{},...n},a[r]=Array.from(new Set([...a[r]||[],...i]))}),{pendingChanges:s,dirtyFields:a}}),hasChanges:e=>{var s,a;return(null!==(a=null===(s=t().dirtyFields[e])||void 0===s?void 0:s.length)&&void 0!==a?a:0)>0},getModifiedFields:e=>t().dirtyFields[e]||[],getPendingChanges:e=>t().pendingChanges[e]||null,getOriginalValue:(e,s)=>{var a;return(null===(a=t().originalData[e])||void 0===a?void 0:a[s])||""}}),{name:"prompt-store",partialize:e=>({pendingChanges:e.pendingChanges,dirtyFields:e.dirtyFields})}));function eA(){let e=eI(),[t,s]=(0,r.useState)(null),[u,m]=(0,r.useState)(null),[p,h]=(0,r.useState)(""),{toast:g}=R(),x=(0,n.NL)();(0,r.useEffect)(()=>{el().then(e=>{console.log("Database connection status:",e),e||g({title:"Connection Error",description:"Could not connect to the database",variant:"destructive"})}).catch(e=>{console.error("Connection test error:",e),g({title:"Connection Error",description:"Failed to test database connection",variant:"destructive"})})},[g]);let{data:b=[],isLoading:y}=(0,l.a)({queryKey:["niches"],queryFn:ea}),{data:v,isLoading:w}=(0,l.a)({queryKey:["niche",t],queryFn:()=>t?er(t):null,enabled:!!t}),[C,k]=(0,r.useState)({});(0,r.useEffect)(()=>{t&&v&&k(e=>({...e,[t]:v}))},[t,v]);let S=e=>{k(t=>({...t,...e}))},O=p?b.filter(e=>e.toLowerCase().includes(p.toLowerCase())):b;(0,r.useEffect)(()=>{v&&t&&(e.setOriginalData(t,v),m(e.getPendingChanges(t)||v))},[v,t]);let{mutate:E,isPending:_}=(0,i.D)({mutationFn:e=>en(e.nicheName,e.changes),onSuccess:()=>{x.invalidateQueries({queryKey:["niche",t]}),g({description:"Changes saved successfully"})}}),F=(s,a)=>{t&&u&&(m({...u,[s]:a}),e.updatePrompt(t,s,a))},I=s=>{t&&v&&(s?F(s,v[s]||""):(m(v),e.clearChanges(t)))},[A,D]=(0,r.useState)(!1),[T,z]=(0,r.useState)({});(0,r.useEffect)(()=>{let t=t=>{if(Object.keys(e.pendingChanges).length>0)return t.preventDefault(),t.returnValue="",""};return window.addEventListener("beforeunload",t),()=>window.removeEventListener("beforeunload",t)},[e.pendingChanges]),(0,r.useCallback)(e=>{s(e)},[]);let M=async()=>{try{let t={};await Promise.all(Object.entries(e.pendingChanges).map(async e=>{let[s,a]=e;await en(s,a),t[s]=a})),S(t),e.clearChanges(),x.invalidateQueries({queryKey:["niche"]}),g({description:"All changes saved successfully"})}catch(e){g({variant:"destructive",description:"Failed to save all changes"})}},L=t=>e.getPendingChanges(t)||C[t]||null;return(0,a.jsx)("main",{className:"min-h-screen bg-gradient-to-b from-background to-muted/50",children:(0,a.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,a.jsxs)("header",{className:"mb-8",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(o.Z,{className:"h-8 w-8 text-primary"}),(0,a.jsx)("h1",{className:"text-4xl font-bold tracking-tight text-foreground",children:"Agent Prompts Management"})]}),(0,a.jsx)(eR,{})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("p",{className:"text-muted-foreground text-lg",children:"Manage and customize AI agent prompts across different niches"}),(0,a.jsxs)("div",{className:"flex gap-4 mb-6",children:[(0,a.jsx)(eN,{niches:Object.fromEntries(Object.keys(C).map(e=>[e,L(e)||C[e]])),onNicheSelect:s,isLoading:w,onOpen:async()=>{}}),(0,a.jsx)(ek,{niches:Object.fromEntries(Object.keys(C).map(e=>[e,L(e)||C[e]])),onReplace:s=>{Object.entries(s).forEach(s=>{let[a,r]=s;e.setPendingChanges(a,r),a===t&&m(r)})},isLoading:w,onOpen:async()=>{}}),(0,a.jsx)(j,{variant:"outline",onClick:()=>I(),disabled:0===Object.keys(e.pendingChanges).length,className:"text-foreground",children:"Reset All Changes"}),(0,a.jsxs)(j,{onClick:M,disabled:0===Object.keys(e.pendingChanges).length,className:"bg-primary text-primary-foreground hover:bg-primary/90",children:[_&&(0,a.jsx)(d.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Save All Changes (",Object.keys(e.pendingChanges).length,")"]})]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6",children:[(0,a.jsx)(f,{className:"lg:col-span-3 p-4 bg-card border-border/50",children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(N,{placeholder:"Search niches...",value:p,onChange:e=>h(e.target.value),className:"w-full bg-background"}),(0,a.jsx)("div",{className:"h-[calc(100vh-300px)] overflow-y-auto",children:y?(0,a.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,a.jsx)(d.Z,{className:"h-6 w-6 animate-spin text-muted-foreground"})}):O.length>0?(0,a.jsx)("div",{className:"space-y-1",children:O.map(r=>(0,a.jsxs)(j,{variant:t===r?"secondary":"ghost",className:"w-full justify-start relative",onClick:()=>s(r),children:[(0,a.jsx)(c.Z,{className:"h-4 w-4 mr-2"}),r,e.hasChanges(r)&&(0,a.jsxs)("div",{className:"ml-auto flex items-center gap-1",children:[(0,a.jsxs)("span",{className:"text-xs text-orange-600 dark:text-orange-400",children:[e.getModifiedFields(r).length," changes"]}),(0,a.jsx)("div",{className:"w-2 h-2 rounded-full bg-orange-500 dark:bg-orange-400"})]})]},r))}):(0,a.jsx)("div",{className:"text-center py-4 text-muted-foreground",children:"No niches found"})})]})}),(0,a.jsx)(f,{className:"lg:col-span-9 p-6",children:t?w?(0,a.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,a.jsx)(d.Z,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):u?(0,a.jsx)(W,{data:u,originalData:v||null,onUpdate:F,onReset:I,modifiedFields:new Set(e.getModifiedFields(t))}):null:(0,a.jsx)("div",{className:"text-center py-12 text-muted-foreground",children:"Select a niche to edit prompts"})})]})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[843,325,130,215,744],()=>t(1981)),_N_E=e.O()}]);